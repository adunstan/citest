task:
  name: Windows
  windows_container:
    image: cirrusci/windowsservercore:2019
  install_script:
    - choco feature disable --name=showDownloadProgress
    - choco list --localonly
    - choco install -y winflexbison diffutils
    - rename c:\ProgramData\chocolatey\bin\win_flex.exe flex.exe
    - rename c:\ProgramData\chocolatey\bin\win_bison.exe bison.exe
#    - choco install -y --no-progress strawberryperl
#    - choco install --force --no-progress -y visualstudio2019-workload-vctools --package-parameters "--includeOptional"
    - choco list --localonly
  build_script:
      - cd
      - set
      - cd "C:/Users/ContainerAdministrator/AppData/Local/Microsoft/WindowsApps"
      - dir /s /b
      - cd "c:/Program Files (x86)/Microsoft Visual Studio/2019/BuildTools/VC/Auxiliary/Build"
      - vcvarsall x64
      - echo on
      - cd C:\Users\ContainerAdministrator\AppData\Local\Temp\cirrus-ci-build
      - set
      - perl -v
      - nmake /?
      - msbuild pgsql.sln
